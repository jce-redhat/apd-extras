---
controller_credential_types:
  - name: ServiceNow User/Password
    description: Username/password credential for a ServiceNow instance (non-OAuth)
    kind: cloud
    inputs:
      fields:
        - id: host
          type: string
          label: ServiceNow host name
          help_text: The FQDN or IP address of the ServiceNow appliance
        - id: username
          type: string
          label: ServiceNow user
          help_text: User used for authentication to the ServiceNow appliance
        - id: password
          type: string
          label: ServiceNow password
          help_text: Password used for authentication to the ServiceNow appliance
          secret: true
      required:
        - host
        - username
        - password
    injectors:
      env:
        SN_HOST: !unsafe '{{ host }}'
        SN_USERNAME: !unsafe '{{ username }}'
        SN_PASSWORD: !unsafe '{{ password }}'

controller_credentials:
  - name: SNOW
    credential_type: ServiceNow User/Password
    organization: Ansible Product Demos (APD)
    update_secrets: false
    state: exists
    inputs:
      host: '{{ lookup("env","SN_HOST") | default("https://example.invalid/", true) }}'
      username: '{{ lookup("env","SN_USERNAME") | default("admin", true) }}'
      password: '{{ lookup("env","SN_PASSWORD") }}'

# TODO remove this once the specified tag is promoted to latest
controller_execution_environments:
  - name: Product Demos EE
    image: quay.io/ansible-product-demos/apd-ee-25:20260108

controller_inventory_sources:
  - name: ServiceNow CMDB
    source: scm
    source_project: APD Extras
    source_path: demos/snow-cmdb/now.yml
    description: Dynamic inventory pulled from the ServiceNow CMDB
    organization: Ansible Product Demos (APD)
    inventory: Ansible Product Demos Inventory
    credential: SNOW
    overwrite: true

controller_templates:
  - name: SNOW | Bulk add demo CMDB server records
    job_type: run
    inventory: Ansible Product Demos Inventory
    credentials:
      - SNOW
    project: APD Extras
    playbook: demos/snow-cmdb/bulk-add-records.yml
    survey_enabled: false

  - name: SNOW | Bulk delete demo CMDB server records
    job_type: run
    inventory: Ansible Product Demos Inventory
    credentials:
      - SNOW
    project: APD Extras
    playbook: demos/snow-cmdb/bulk-delete-records.yml
    survey_enabled: false

  - name: SNOW | Create a server record in the CMDB
    job_type: run
    inventory: Ansible Product Demos Inventory
    credentials:
      - SNOW
    project: APD Extras
    playbook: demos/snow-cmdb/add-server-record.yml
    survey_enabled: true
    survey:
      name: ''
      description: ''
      spec:
        - question_name: Server FQDN
          variable: snow_server_fqdn
          required: true
          type: text
        - question_name: Server IP address
          variable: snow_server_ip
          required: false
          type: text
        - question_name: Server OS
          variable: snow_server_os
          required: false
          type: multiplechoice
          choices:
            - RHEL 9
            - RHEL 10
            - Windows Server 2019
            - Windows Server 2022

  - name: SNOW | Delete a server record from the CMDB
    job_type: run
    inventory: Ansible Product Demos Inventory
    credentials:
      - SNOW
    project: APD Extras
    playbook: demos/snow-cmdb/delete-server-record.yml
    survey_enabled: true
    survey:
      name: ''
      description: ''
      spec:
        - question_name: Server FQDN
          variable: snow_server_fqdn
          required: true
          type: text

controller_workflows:
  - name: 'ServiceNow: Create SNOW CMDB records'
    description: Create a set of pre-configured server records in the SNOW CMDB
    organization: Ansible Product Demos (APD)
    survey_enabled: false
    simplified_workflow_nodes:
      - identifier: Add demo server records to SNOW
        unified_job_template: SNOW | Bulk add demo CMDB server records
        success_nodes:
          - Inventory Sync
      - identifier: Inventory Sync
        unified_job_template: ServiceNow CMDB

  - name: 'ServiceNow: Delete SNOW CMDB records'
    description: Delete a set of pre-configured server records in the SNOW CMDB
    organization: Ansible Product Demos (APD)
    survey_enabled: false
    simplified_workflow_nodes:
      - identifier: Delete demo server records from SNOW
        unified_job_template: SNOW | Bulk delete demo CMDB server records
        success_nodes:
          - Inventory Sync
      - identifier: Inventory Sync
        unified_job_template: ServiceNow CMDB

...
